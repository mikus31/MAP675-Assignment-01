<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <!--A pun for those Austin City Limits fans!-->
    <title>Austin Doggie Limits</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css?family=Slabo+27px" rel="stylesheet">
    <style>
        body,
        #map {
            position: absolute;
            width: 100%;
            top: 0;
            bottom: 0;
            margin: 0;
            padding: 0;
            background: rgba(0, 0, 0, .75);
        }

        #title {
            font-family: 'Slabo 27px', serif;
            position: absolute;
            background-color: black;
            top: 5px;
            left: 60px;
            padding: 5px;
            border-radius: 10px;
            border-color: white;
            border-width: 2px;
            border-style: solid;
            z-index: 650;
            opacity: .9;
        }

        /*        increased opacity so that the underlying features don't bleed through the title'*/

        h1,
        h2 {
            font-family: 'Slabo 27px', serif;
            color: white;
            margin: 0px;
        }

        h2 {
            font-size: 1.0em;
            font-style: italic;
        }

        .tooltip {
            color: #295b97;
            background: #b3b3b3;
            border: 0;
            font-size: 1.3em;
            font-weight: bold;
        }
        .legendP
        {
           color: #295b97; 
        }
        .legendItem
        {
            display: inline-block;
        }
        
        .legend {
            padding: 6px 8px;
            font-size: 1em;
            background: rgba(75, 75, 75, 0.8);
            color: whitesmoke;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            width: 160px;
        }
        
        .legend h3 {
            font-size: 1.1em;
            font-weight: bold;
            line-height: 1em;
            color: whitesmoke;
            margin: 0;
        }
        
        .legend h3 span {
            font-size: 1.3em;
            margin: 0 20px 0 0;
        }
        
        .legend ul {
            list-style-type: none;
            padding: 0;
            margin: 12px 4px 0;
        }
        
        .legend li {
            height: 22px;
            color: whitesmoke;
        }
        .legend img {
            vertical-align: middle;
            padding-right: 5px;
        }

    </style>
</head>

<body>
    <div id="title">
        <h1>Get Outside With Your Four-Legged Friends!</h1>
        <!--        added first-letter caps for words in title and subtitle-->
        <h2>Off-Leash Areas, Parks, And Trails Within Austin City Limits</h2>
        
    </div>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script>
        //Options to be used to style the features        
        var cityLimitsOptions = {
            color: 'grey',
            fillColor: 'grey',
            fillOpacity: .2,
            opacity: 1,
            weight: 3,
        };
        var urbanTrailsOptions = {
            color: '#F8AA5D',
            weight: 1.5,
            opacity: 1
        };
        var offLeashAreasOptions = {
            radius: 6,
            fillOpacity: .8,
            fillColor: '#ff0056',
            color: '#151f2b',
            weight: 1.5,
            opacity: 1
        };
        var parksOptions = {
            fillOpacity: .5,
            fillColor: '#5BB106',
            color: '#5BB106',
            weight: 1.5,
            opacity: 1
        };
        //map options.
        var options = {
            zoomSnap: 0.25,
        };
        //create the map!
        var map = L.map('map', options);
        //Use carto layer as a basemap
        L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        //wait until all the GeoJSON loads, then draw the map.
        $.when($.getJSON('data/Austin-City-Outline.json'), $.getJSON('data/austin-parks-filtered.json'), $.getJSON('data/off-leash-areas.json'), $.getJSON('data/urban-trails-filtered.json')).done(function(cityLimits, parks, offLeashAreas, urbanTrails) {
            drawMap(cityLimits, parks, offLeashAreas, urbanTrails);
            drawLegend();
        });

        //funtion to handle drawing the map.
        function drawMap(cityLimitsData, parksData, offLeashAreasData, urbanTrailsData) {
            //create a variable so we can get the bounds to zoom to the
            var citylim = L.geoJson(cityLimitsData, {
                style: cityLimitsOptions

            }).addTo(map);
            L.geoJson(parksData, {
                style: parksOptions,
                //parse through the features to set styles and events
                onEachFeature: function(feature, layer) {
                    // create the tooltip for identification
                    var tooltip = feature.properties.park_name;
                    // bind the tooltip to the layer
                    layer.bindTooltip(tooltip, {
                        sticky: true,
                        className: 'tooltip'
                    });
                    // visual affordance on mouseover
                    layer.on('mouseover', function(e) {
                        this.setStyle({
                            fillOpacity: .1
                        });
                    });
                    // use existing option to reset the styles on mouseout
                    layer.on('mouseout', function(e) {
                        this.setStyle(parksOptions);
                    });
                }
            }).addTo(map);
            L.geoJson(urbanTrailsData, {
                style: urbanTrailsOptions,
                //parse through the features to set styles and events
                onEachFeature: function(feature, layer) {
                    // create the tooltip for identification
                    var tooltip = feature.properties.urban_tr_3;
                    // bind the tooltip to the layer
                    layer.bindTooltip(tooltip, {
                        sticky: true,
                        className: 'tooltip'
                    });
                    // visual affordance on mouseover
                    layer.on('mouseover', function(e) {
                        this.setStyle({
                            opacity: .6,
                            color: 'yellow',
                            weight: 3
                        });
                    });
                    // use existing option to reset the styles on mouseout
                    layer.on('mouseout', function(e) {
                        this.setStyle(urbanTrailsOptions);
                    });
                }
            }).addTo(map);
            L.geoJson(offLeashAreasData, {
                //parse through the features to set styles and events.  
                //Points are handled differently so let us make them into Circles instead of Markers.
                pointToLayer: function(feature, latlng) {
                    var layer = L.circleMarker(latlng, offLeashAreasOptions);
                    // create the tooltip for identification
                    var tooltip = feature.properties.name;
                    // bind the tooltip to the layer
                    layer.bindTooltip(tooltip, {
                        sticky: true,
                        className: 'tooltip'
                    });
                    // visual affordance on mouseover
                    layer.on('mouseover', function(e) {
                        this.setStyle({
                            fillOpacity: .5
                        });
                    });
                    // use existing option to reset the styles on mouseout
                    layer.on('mouseout', function(e) {
                        this.setStyle(offLeashAreasOptions);
                    });
                    return layer;
                }
            }).addTo(map);
            //zoom the map to fit the city boundary
            map.fitBounds(citylim.getBounds()).zoomOut(.5);



        }
        //function to draw our legend on the map
        function drawLegend() {
            var legendControl = L.control({
                position: 'bottomleft'
            });

            legendControl.onAdd = function(map) {

                var legend = L.DomUtil.create('div', 'legend');

                legend.innerHTML = ("<h3>Parks and Recreation</h3><ul>");

                legend.innerHTML += '<ul><li><img src="icons\\OffLeash.png" alt="Off Leash">Off Leash Areas</li>';
                legend.innerHTML += '<ul><li><img src="icons\\trails.png" alt="Off Leash">Urban Trails</li>';
                legend.innerHTML += '<ul><li><img src="icons\\park.png" alt="Off Leash">Parks</li>';
                legend.innerHTML += "</ul>";


                return legend;

            };

            legendControl.addTo(map);
        }
        // we should probably add a click.on feature function so that the user can get info like names of parks, trails, areas, etc

    </script>
</body>

</html>
